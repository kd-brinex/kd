<!DOCTYPE html>
<!-- saved from url=(0053)http://georgeosddev.github.io/markdown-edit/view.html -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Markdown Edit</title>
  <link rel="stylesheet" href="http://georgeosddev.github.io/markdown-edit/vendor/html5-boilerplate-4.0.0/css/normalize.css">
  <link rel="stylesheet" href="http://georgeosddev.github.io/markdown-edit/css/github-style.css">
  <link rel="stylesheet" href="http://georgeosddev.github.io/markdown-edit/vendor/highlight.js/styles/github.css">
  <style type="text/css">
    body {
      margin:20px 30px;
    }
  </style>
<link id="htmlStyle" rel="stylesheet" href="http://georgeosddev.github.io/markdown-edit/css/empty.css"></head>
<body>
<script>
  document.body.onload = function(){
    var style = opener.document.getElementById("htmlStyle");
    var clone = style.cloneNode(true);
    document.head.appendChild(clone);

    var src = opener.document.getElementById("out");
    var clonenode = src.cloneNode(true);
    document.body.appendChild(clonenode);
  };
</script>

<div id="out" class="markdown-body display-none" style="display: block;"><h1 id="auto2d-api">Auto2D API</h1>
<h4 id="-">Инструкция по развертыванию</h4>
<p>Скопировать конфигурационный файл:</p>
<pre><code class=" hljs avrasm"><span class="hljs-keyword">cp</span> _cfg<span class="hljs-preprocessor">.php</span>-dist _cfg<span class="hljs-preprocessor">.php</span>
</code></pre><p>Прописать в нем свои учетные данные, полученные при регистрации:</p>
<pre><code class=" hljs lasso"><span class="hljs-class"><span class="hljs-keyword">define</span></span>(<span class="hljs-string">"LOGIN"</span>,<span class="hljs-string">"ВАШ_ЛОГИН"</span>);
<span class="hljs-class"><span class="hljs-keyword">define</span></span>(<span class="hljs-string">"PASSWD"</span>,<span class="hljs-string">"ВАШ_ПАРОЛЬ"</span>);
</code></pre><hr>
<h4 id="-">Требование:</h4>
<p>
    Версия <strong>PHP 5.4</strong> и выше<br>
    Установленный <strong>cURL</strong><br>
    <br>
    Если в CentOS ошибка &laquo;<strong>Class 'XMLWriter' not found in</strong>&raquo;, то надо доустановить его:
    <pre>yum -y install php-xml</pre>
</p>
<hr>
<h4 id="-php-">Описание PHP папок и скриптов:</h4>
<pre><code class=" hljs haml">_cfg.php-dist      - Данный файл необходимо скопировать или переименовать в _cfg.php
_lib.php           - Общий класс. Вынесены общие функции, используемые на всем следовании по каталогу
_lng.php           - (устарел) Файл локализаций aka мультиязычность. Описание работы и причина ниже  

-<span class="ruby"><span class="hljs-constant">README</span>.md         - Описание каталога (этот файл. Формат <span class="hljs-constant">Markdown</span>)
</span>-<span class="ruby"><span class="hljs-constant">README</span>.html       - Описание каталога (этот файл. Формат <span class="hljs-constant">HTML</span>)
</span>
-<span class="ruby">index.php         - Пример реализации входной точки. Первый запрос (в данных примерах) ведет на types.php  
</span>-<span class="ruby">types.php         - Получение типов автомобилей  
</span>-<span class="ruby">marks.php         - Получение марок автомобилей. Варианты<span class="hljs-symbol">:</span> все, по типу  
</span>
-<span class="ruby">search.php        - (в планах) Модуль, объединяющий все поиски. Пока <span class="hljs-string">"копим"</span> базу
</span>
-<span class="ruby">helpers           - Директория со скриптами-помощниками, используемых во всех каталогах
</span>-<span class="ruby">-breads.php       - Построение <span class="hljs-string">"хлебных крошек"</span>
</span>-<span class="ruby">-illustration.php - Подстветка строк и номеров на иллюстрации, копирование в буфер
</span>-<span class="ruby">-search.php       - Конструктор для формы поиска
</span>-<span class="ruby">-zoomer.php       - Панель для иллюстрации, функция перетаскивания, масштабирование
</span>

-<span class="ruby">adc               - Каталог со скриптами для АвтоКаталога
</span>-<span class="ruby">-<span class="hljs-constant">README</span>.md        - Описание каталога (формат <span class="hljs-constant">Markdown</span>)
</span>-<span class="ruby">-<span class="hljs-constant">README</span>.html      - Описание каталога (формат <span class="hljs-constant">HTML</span>)
</span>-<span class="ruby">-api.php          - Файл запросов только для текущего каталога. Некая обертка над запросами для упрощения разработки  
</span>-<span class="ruby">-models.php       - Получение моделей. Варианты<span class="hljs-symbol">:</span> все, по типу, по марке, по марке и типу  
</span>-<span class="ruby">-tree.php         - Построение дерева деталей для модели  
</span>-<span class="ruby">-map.php          - Карта конкретной части (двигатель, тормозная система, ..) автомобиля с изображением и номенклатурой  
</span>-<span class="ruby">-detailInfo.php   - Информация о детали в всплывающем окне  
</span>-<span class="ruby">-search           - Каталог со скриптами для поиска только по АвтоКаталогу
</span>-<span class="ruby">--detail.php      - Пример реализации функций поиска детали  
</span>-<span class="ruby">--models.php      - Пример реализации функций поиска модели автомобиля  
</span>

-<span class="ruby">bmw               - Каталог со скриптами для оригинально каталога <span class="hljs-constant">BMW</span>, <span class="hljs-constant">BMW</span> moto, <span class="hljs-constant">Mini</span>, <span class="hljs-constant">Rolls</span>-<span class="hljs-constant">Royce</span>  
</span>-<span class="ruby">-<span class="hljs-constant">README</span>.md        - Описание каталога (формат <span class="hljs-constant">Markdown</span>)
</span>-<span class="ruby">-<span class="hljs-constant">README</span>.html      - Описание каталога (формат <span class="hljs-constant">HTML</span>)
</span>-<span class="ruby">-api.php          - Файл запросов только для текущего каталога. Некая обертка над запросами для упрощения разработки  
</span>-<span class="ruby">-series.php       - Точка входа в каталог. Получение серий выпускаемой техники по нужной марке (<span class="hljs-constant">BMW</span>, <span class="hljs-constant">BMW</span> moto, <span class="hljs-constant">Mini</span>, <span class="hljs-constant">Rolls</span>-<span class="hljs-constant">Royce</span>)
</span>-<span class="ruby">-models.php       - Список поделей в выбранной серии (далее слово будет опускаться, итак понятно/логично что произошел выбор)
</span>-<span class="ruby">-options.php      - Доступные опции для модели (расположение руля, КПП)
</span>-<span class="ruby">-production.php   - Период производства модели
</span>-<span class="ruby">-groups.php       - Основные группы деталей для модели
</span>-<span class="ruby">-subgroups.php    - Список деталей, входящих в группу/узел
</span>-<span class="ruby">-illustration.php - Иллюстрация детали со списком номенклатуры
</span>-<span class="ruby">-search           - Каталог со скриптами для поиска только по каталогу <span class="hljs-constant">BMW</span>  
</span>-<span class="ruby">--detail.php      - Пример реализации функций поиска детали  
</span>-<span class="ruby">--vin.php         - Пример реализации функций поиска модели автомобиля по <span class="hljs-constant">VIN</span>  
</span>
-<span class="ruby">etka              - Каталог со скриптами для оригинально каталога <span class="hljs-constant">ETKA</span> - <span class="hljs-constant">Audi</span>, <span class="hljs-constant">Seat</span>, <span class="hljs-constant">Skoda</span>, <span class="hljs-constant">Volkswagen</span>
</span>                   -<span class="ruby"> Запланирован для интеграции (в разработке на завершающем этапе)
</span>

-<span class="ruby">toyota            - Каталог со скриптами для оригинально каталога <span class="hljs-constant">Toyota</span> и <span class="hljs-constant">Lexus</span>  
</span>-<span class="ruby">-<span class="hljs-constant">README</span>.md        - Описание каталога (формат <span class="hljs-constant">Markdown</span>)
</span>-<span class="ruby">-<span class="hljs-constant">README</span>.html      - Описание каталога (формат <span class="hljs-constant">HTML</span>)
</span>-<span class="ruby">-api.php          - Файл запросов только для текущего каталога. Некая обертка над запросами для упрощения разработки  
</span>-<span class="ruby">-markets.php      - Входная точка в каталог. Получение рынков по производству
</span>-<span class="ruby">-models.php       - Список моделей для рынка
</span>-<span class="ruby">-options.php      - Доступные комплектации для модели
</span>-<span class="ruby">-groups.php       - Группы деталей
</span>-<span class="ruby">-illustration.php - Иллюстрация детали со списком номенклатуры
</span>-<span class="ruby">-search           - Каталог со скриптами для поиска по АвтоКаталогу
</span>-<span class="ruby">--vin.php         - Пример реализации функций поиска модели автомобиля по <span class="hljs-constant">VIN</span>  
</span>-<span class="ruby">--frame.php       - Пример реализации функций поиска модели автомобиля по фрейму и номеру  
</span>-<span class="ruby">--tpl             - Файлы для визуалицации полученных данных (их структура неоднозначна)
</span>-<span class="ruby">---vin            - Для возвращаемых данных с поиска по <span class="hljs-constant">VIN</span>
</span>-<span class="ruby">---frame          - Для возвращаемых данных с поиска по фрейму и номеру
</span>

-<span class="ruby">media             - Каталог с медиафайлами для визуального оформления данных, полученных от сервера АвтоДилер  
</span>-<span class="ruby">-css              - Файлы стилей. Файлы с именем как у каталогов используются только в этих каталогах  
</span>-<span class="ruby">--fw.css          - Микро-фреймворк с заготовленными часто используемыми стилями 
</span>-<span class="ruby">--style.css       - Общий файл со стилями  
</span>-<span class="ruby">--ОСТАЛЬНЫЕ       - Используются в своих каталогах по названию файла. НО! Ничто нам не мешаем манипулировать этими файлами
</span>-<span class="ruby">-js               - Диреектория с <span class="hljs-constant">JavaScript</span> и jQuery скрпитам. К примеру<span class="hljs-symbol">:</span>
</span>-<span class="ruby">--myTree.js       - Реализации дерева деталей для АвтоКаталога
</span>-<span class="ruby">-images           - Все изображения используемые в данных примерах
</span></code></pre><blockquote>
<p>Полее подробное описание находится внутри каждого каталога</p>
<p>Так как оригинальные каталоги также интегрированны в наш каталог, то общие входные точки для всех остануться types.php =&gt; marks.php
Далее в системе идет деление по директориям для каждого каталогам, чтобы не было путаницы в файлах.
В процессе работы обратите внимание, что все оригинальные каталоги можно использовать независимо друг от друга, что позволяет добиться больше гибкости при выборе нужных каталогов.
Не смотря на то, что types.php =&gt; marks.php используются в корне, опиание функций, используемых для получении данных, находятся в adc/README.MD</p>
<p>На страницах с иллюстрациями доступна функция копирования номера в буфер</p>
</blockquote>
<hr>
<h4 id="-">Общие моменты</h4>
<p>Все общение с сервером ведется по средствам <strong>GET</strong> или <strong>POST</strong> запросов<br>Переменная с одинаковым именем и в <strong>GET</strong>, и в <strong>POST</strong> получит значение из <strong>POST</strong><br>Данные с сервера приходят в виде <strong>json</strong> строки, которая преобразуется в объект</p>
<hr>
<h4 id="-">Во всех запросах:</h4>
<p><strong>u</strong> - ваш логин<br><strong>p</strong> - ваш пароль<br><strong>f</strong> - имя функции<br><strong>t</strong> - тип каталога</p>
<p>Доступные типы каталогов на текущий момент:<br><strong>t=BMW</strong> - Оригинальный каталог от <strong>BMW</strong>: <code>BMW Auto, BMW Moto, Mini, Rolls-Royce</code><br><strong>t=TOY</strong> - Оригинальный каталог от <strong>Toyota</strong>: <code>Toyota, Lexus</code></p>
<blockquote>
<p>Для каталога от АвтоДилер тип не указывается</p>
</blockquote>
<p>Идентификатор или алиас марки получаем со страницы марок <strong>marks.php</strong>  </p>
<hr>
<h4 id="-">Хлебные крошки</h4>
<p>Так как в каталогах АвтоДилер одновременно не используется больше 4-х параметров, то и надобности в "хлебных крошках" не было и они формировались прямо в HTML документе.<br>С появлением внешних каталогов и с их количеством передаваемых переменных, пришлось разработать функцию на стороне сервера, вместо того чтобы отдавать кучу переменных для построения "хлебных крошек".
Функция в каждом запросе возвращает набор данных для каждого из прошедших этапов.<br>К примеру<em>(преобразовав в массив)</em> на одном из этапов можно увидеть подобное:</p>
<pre><code class=" hljs json">[
    'types' =&gt; [
        <span class="hljs-string">"name"</span> =&gt; 'Каталог',
        <span class="hljs-string">"breads"</span> =&gt; []
    ],
    'marks' =&gt; [
        <span class="hljs-string">"name"</span> =&gt; $sTypeName,
        <span class="hljs-string">"breads"</span> =&gt; [
            <span class="hljs-number">0</span> =&gt; $sTypeID,
            <span class="hljs-number">1</span> =&gt; $sMarkID
        ]
    ]
]
</code></pre><p>где <strong>types</strong> и <strong>marks</strong> - имена файлов, которым будут передаваться переменные в последовательности, что сперва получаем типы/группы, потом марки</p>
<p>На следующем уровне:<br><strong>name</strong> - имя "хлебной крошки"<br><strong>breads</strong> - массив с переменными нужный для получения данных при переходе по крошке<br>Порядок переменных должен совпадать с переменной <strong>$arrActions</strong> из <strong>*/api.php*</strong>(пример)*:</p>
<pre><code class=" hljs scss"><span class="hljs-value">static</span><span class="hljs-value">::$arrActions = [<span class="hljs-string">'typeID'</span>,<span class="hljs-string">'markID'</span>,<span class="hljs-string">'modelID'</span>,<span class="hljs-string">'treeID'</span>];</span>
</code></pre><p>В основном это в случае с каталогом от АвтоДилер<br>Для остальных каталогов массив "хлебных крошек" возвращается с сервера и подгоняется уже сама переменная <strong>static::$arrActions</strong><br>Имена можно выбрать абсолютно любые, главное потом получать значения по нужным именам.  </p>
<p>Для построение "хлебных крошек" используется конструктор <strong>helpers/breads.php</strong><br>Как его готовить можно глянуть в скриптах каталогов.</p>
<hr>
<h4 id="-">Форма поиска</h4>
<p>Для построения формы с поиском используется файл <strong>helpers/search.php</strong><br>До подключения файла нужно определить переменные для конструктора.
Так как поиски и поля для форм разные для каждого каталога, будет разумно определять переменные непосредственно в самих файлах API к каталогу, к примеру, в <strong>toyota/api.php</strong><br>Чтобы не создавать дополнительных методов реализовать это можно в методе <strong>__construct</strong>, который вызывается в момент установки объекта.<br>Рассмотрим пример переменной, чтобы отбросить лишние вопросы в будущем:</p>
<pre><code class=" hljs php"><span class="hljs-keyword">static</span>::<span class="hljs-variable">$searchTabs</span> = [[
    <span class="hljs-string">'id'</span>    =&gt; <span class="hljs-number">1</span>,
    <span class="hljs-string">'alias'</span> =&gt; <span class="hljs-string">'vin'</span>,
    <span class="hljs-string">'name'</span>  =&gt; <span class="hljs-string">'VIN'</span>, <span class="hljs-comment">/// В контексте "Укажите ..."</span>
    <span class="hljs-string">'tName'</span> =&gt; <span class="hljs-string">'Поиск по VIN'</span>,
],[
    <span class="hljs-string">'id'</span>     =&gt; <span class="hljs-number">2</span>,
    <span class="hljs-string">'action'</span> =&gt; <span class="hljs-string">'frame'</span>,
    <span class="hljs-string">'multi'</span>  =&gt; [[
        <span class="hljs-string">'alias'</span> =&gt; <span class="hljs-string">'frame'</span>,
        <span class="hljs-string">'name'</span>  =&gt; <span class="hljs-string">'фрейм'</span>, <span class="hljs-comment">/// В контексте "Укажите ..."</span>
    ],[
        <span class="hljs-string">'alias'</span> =&gt; <span class="hljs-string">'number'</span>,
        <span class="hljs-string">'name'</span>  =&gt; <span class="hljs-string">'номер'</span>, <span class="hljs-comment">/// В контексте "Укажите ..."</span>
    ]],

    <span class="hljs-string">'tName'</span> =&gt; <span class="hljs-string">'Поиск по номеру детали'</span>,
]];
</code></pre><p><strong>id</strong> - идентификатор для вкладки<br><strong>alias</strong> - имя поля, по которому потом будем ловить переменную в скриптах. В случае с одним полем, <strong>alias</strong> также может служит именем файла, в который передаются переменные<br><strong>name</strong> - служит плейсхолдером - текст подсказка пользователю, что вводить<br><strong>action</strong> - имя скрипта, в который передаем параметры с формы (можно опустить, если поле одно)
<strong>multi</strong> - используем массив если нужно передать не одно значение<br><strong>tName</strong> - название вкладки в форме поиска</p>
<hr>
<h4 id="-">Мультиязчность</h4>
<p><strong>! Устаревшая функция</strong>:<br><em>Во всех современных системах есть свои функции, позволяющие организовать мультиязычность сайта</em> 
<em>Поэтому данную функцию оставили исключительно как идею для реализации, вдруг кому и пригодится</em> </p>
<p>В файле <strong>_lng.php</strong> копируем массив: <code>protected static $ru = array(...);</code><br>под другим именем<em>(к примеру)</em>: <code>protected static $ru2 = array(...);</code><br>В <strong>_lib.php</strong> указываем с каким массивом работать: <code>protected static $_lng = "ru2";</code></p>
<p><strong>Структура массива в _lng.php:</strong>  </p>
<pre><code class=" hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">$ru</span> = <span class="hljs-keyword">array</span>(
        <span class="hljs-string">'types'</span> =&gt; <span class="hljs-keyword">array</span>(
            <span class="hljs-string">'h1'</span>       =&gt; <span class="hljs-string">'Список типов авто'</span>,
            <span class="hljs-string">'fstitle'</span>  =&gt; <span class="hljs-string">'Быстрый поиск марок и моделей'</span>,
            <span class="hljs-string">'fsititle'</span> =&gt; <span class="hljs-string">'Быстрый поиск марок и моделей (Alt+Ч)'</span>,
        ),
);
</code></pre><blockquote>
<p>$ru - язык,<br>types - в каком файле использовать,<br>h1 - название переменной, после =&gt; ее значение.</p>
</blockquote>
<p><strong>Использовать так:</strong></p>
<pre><code class=" hljs xml"><span class="php"><span class="hljs-preprocessor">&lt;?</span>=A2D::__(<span class="hljs-string">'h1'</span>)<span class="hljs-preprocessor">?&gt;</span></span> (html)
A2D::__('h1')      (php)
</code></pre><hr>
<p><a href="https://bitbucket.org/AutoDealerRU/api/get/master.zip" title="api.zip">Скачать</a></p>
<p><a href="http://acat.autodealer.ru/" title="AutoCatalog">Демонстастрационнный сайт</a></p>
<p><a href="http://autodealer.ru/" title="AutoDealer">Офсайт организации</a></p>
</div></body></html>